# Aquarius32 TRM

## Memory map

| Address       |    Width | Description                  |
| ------------- | -------: | ---------------------------- |
| 00000 - 007FF | 8/16/32b | Boot ROM (2kB)               |
| 00800 - 01FFF |        - | -                            |
| 02000         |      32b | ESP CTRL                     |
| 02004         |      32b | ESP DATA                     |
| 02008         |      32b | VCTRL                        |
| 0200C         |      32b | VSCRX                        |
| 02010         |      32b | VSCRY                        |
| 02014         |      32b | VLINE                        |
| 02018         |      32b | VIRQLINE                     |
| 0201C         |      32b | KEYBUF                       |
| 02020 - 027FF |        - | -                            |
| 02800 - 02FFF |      32b | FM synthesizer               |
| 03000 - 031FF |      32b | Sprite attributes (64x2x32b) |
| 03200 - 03FFF |        - | -                            |
| 04000 - 0407F |      16b | Palette (4x16 entries)       |
| 04080 - 04FFF |        - | -                            |
| 05000 - 057FF |       8b | Character RAM (2kB)          |
| 05800 - 05FFF |        - | -                            |
| 06000 - 06FFF |    8/16b | Text RAM (4kB)               |
| 07000 - 07FFF |        - | -                            |
| 08000 - 0FFFF | 8/16/32b | VRAM (32kB)                  |
| 10000 - 1FFFF | 8/16/32b | VRAM 4bpp addressable (64kB) |
| 20000 - 7FFFF |        - | -                            |
| 80000 - FFFFF | 8/16/32b | RAM (512kB) (cached)         |

## VCTRL

| 31:6 |   5    |            4             |   3    |       2       |       1        |    0    |
| :--: | :----: | :----------------------: | :----: | :-----------: | :------------: | :-----: |
|  -   | Spr_en | Gfx_mode: bm(0), tile(1) | Gfx_en | Text_priority | Text_80columns | Text_en |

## Sprite attributes

Even addresses:

| 31:25 | 24:16 | 15:8 | 7:0 |
| :---: | :---: | :--: | :-: |
|   -   |   Y   |  -   |  X  |

Odd addresses:

| 31:16 |    15    |  14:13  |   12   |   11   |    10     |       9:0        |
| :---: | :------: | :-----: | :----: | :----: | :-------: | :--------------: |
|   -   | Priority | Palette | V-flip | H-flip | Height:16 | Tile index (9:0) |

# Video RAM data

| Address   | Description                        |
| --------- | ---------------------------------- |
| 0000-7FFF | Tile data (overlaps with tile map) |
| 0000-7CFF | Bitmap data                        |
| 7000-7FFF | Tile map                           |

## Tile map

64x32 entries, each with the following format:

|    15    |  14:13  |   12   |   11   | 10  |       9:0        |
| :------: | :-----: | :----: | :----: | :-: | :--------------: |
| Priority | Palette | V-flip | H-flip |  -  | Tile index (9:0) |

# FM synthesizer

### Register 0

This register indicates what channel pairs are used as 4-channel operator.

| 31:16 |    15    |    14    |    13    |    12    |    11    |    10    |    9     |    8     |    7     |    6     |    5     |   4    |   3    |   2    |   1    |   0    |
| :---: | :------: | :------: | :------: | :------: | :------: | :------: | :------: | :------: | :------: | :------: | :------: | :----: | :----: | :----: | :----: | :----: |
|   -   | CH 31/30 | CH 29/28 | CH 27/26 | CH 25/24 | CH 23/22 | CH 21/20 | CH 19/18 | CH 17/16 | CH 15/14 | CH 13/12 | CH 11/10 | CH 9/8 | CH 7/6 | CH 5/4 | CH 3/2 | CH 1/0 |

### Register 1

| 31:15 | 14  | 13:8 |  7  |  6  | 5:0 |
| :---: | :-: | :--: | :-: | :-: | :-: |
|   -   | NTS |  -   | DAM | DVB |  -  |

| Name | Description                         |
| ---- | ----------------------------------- |
| NTS  | Note sel (keyboard split selection) |
| DAM  | Amplitude modulation depth          |
| DVB  | Vibrato depth                       |

### Register 2

Each bit in this register controls the Key-on signal of each channel

### Registers 96-127 Channel attributes

| 31:22 | 21  | 20  | 19:17 | 16  | 15:13 | 12:10 | 9:0  |
| :---: | :-: | :-: | :---: | :-: | :---: | :---: | :--: |
|   -   | CHB | CHA |  FB   | ALG |   -   | BLOCK | FNUM |

| Name  | Description                                    |
| ----- | ---------------------------------------------- |
| CHB   | Mix to channel B                               |
| CHA   | Mix to channel A                               |
| FB    | Modulation depth for slot 1 FM feed back (0-7) |
| ALG   | Operation connection (algorithm)               |
| KON   | Key on                                         |
| BLOCK | Octave (0-7)                                   |
| FNUM  | Frequency number (10 bit)                      |

### Registers 128-191 Operator attributes 0

| 31  | 30  | 29  | 28  | 27:24 | 23:22 | 21:16 | 15:8 | 11:8 | 7:4 | 3:0 |
| :-: | :-: | :-: | :-: | :---: | :---: | :---: | :--: | :--: | :-: | --- |
| AM  | VIB | SUS | KSR | MULT  |  KSL  |  TL   |  AR  |  DR  | SL  | RR  |

| Name | Description                                   |
| ---- | --------------------------------------------- |
| AM   | Amplitude modulation (Tremelo)                |
| VIB  | Vibrato                                       |
| SUS  | 0:Skip sustain phase, 1:Sustain until key off |
| KSR  | Key scale rate                                |
| MULT | Frequency data multiplier (0-15)              |
| KSL  | Key scale level (0-3)                         |
| TL   | Total level (0-63)                            |
| AR   | Attack Rate (0-15)                            |
| DR   | Decay Rate (0-15)                             |
| SL   | Sustain Level (0-15)                          |
| RR   | Release Rate (0-15)                           |

### Registers 192-255 Operator attributes 1

| 31:3 | 2:0 |
| :--: | --- |
|  -   | WS  |

| Name | Description       |
| ---- | ----------------- |
| WS   | Wave select (0-7) |

## CPU

RISC-V
RAM cache
